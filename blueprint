blueprint:
  name: Raspberry Pi Command with Custom Payload
  description: Send a command with a custom payload to a specific Raspberry Pi or all Raspberry Pis.
  domain: automation
  input:
    trigger:
      name: Trigger
      description: Define the trigger for the automation.
      selector:
        trigger:
    raspberry_pi_hostname:
      name: Raspberry Pi Hostname
      description: Enter the hostname of the Raspberry Pi (e.g., blueberry01). Use 'blueberry' to target all.
      selector:
        text:
    action:
      name: Action
      description: The action to be performed.
      selector:
        text:
    additional_parameters:
      name: Additional Parameters
      description: Additional parameters in JSON-like format (key:value, separated by commas).
      default: '{}'
      selector:
        text:

trigger: !input 'trigger'

action:
  - service: mqtt.publish
    data_template:
      topic: >
        {% set hostname = raspberry_pi_hostname | lower %}
        {% if hostname == 'blueberry' %}
          home/+/action
        {% else %}
          home/{{ hostname }}/action
        {% endif %}
      payload: >
        {% set action_val = action | lower %}
        {% set additional_params = additional_parameters | from_json %}
        {% set payload_dict = {'action': action_val} | combine(additional_params) %}
        {{ payload_dict | tojson }}
